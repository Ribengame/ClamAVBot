FROM python:3.11-slim

# 
RUN mkdir -p /usr/share/man/man1 \
 && apt update \
 && apt -y install git ca-certificates dnsutils iproute2 make build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev libffi-dev liblzma-dev libgdbm-dev uuid-dev openjdk-17-jre-headless clamav clamav-daemon \
 && freshclam \
 && rm -rf /var/lib/apt/lists/*

#
RUN mkdir -p /home/container/.config/ClamAVBot /home/container/.local/share/ClamAVBot/data/pterodactyl

WORKDIR /home/container

#
RUN git clone https://github.com/Ribengame/ClamAVBot.git /home/container

#
RUN useradd -m -d /home/container container \
 && chown -R container:container /home/container

#
RUN pip install --upgrade pip \
 && su - container -c 'pip install --upgrade pip wheel' \
 && su - container -c 'pip install --no-cache-dir -r /home/container/requirements.txt'

#
USER container

#
CMD ["python3", "/home/container/bot.py"]
